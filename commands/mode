import fs from "fs";
import config from "../config.js";
import { isOwner } from "../utils/isOwner.js";
import { getMode } from "../utils/getMode.js";

export default {
  name: "mode",
  description: "Switch bot mode between public and private (Owner only)",
  async execute(sock, msg, args) {
    const from = msg.key.remoteJid;
    const sender = msg.key.participant || msg.key.remoteJid;
    const botName = "NexOra";

    // âœ… Owner check
    if (!isOwner(sender)) {
      return sock.sendMessage(
        from,
        { text: "âŒ Only owner can change mode!" },
        { quoted: msg }
      );
    }

    // âœ… Show current mode if no argument
    if (!args[0]) {
      const currentMode = getMode();
      return sock.sendMessage(
        from,
        {
          text: `
â”â”â”âš™ï¸ *${botName.toUpperCase()} MODE* â”â”â”“
ğŸ”¹ Current Mode: *${currentMode.toUpperCase()}*

Use:
â€¢ .mode public
â€¢ .mode private
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
          `.trim(),
        },
        { quoted: msg }
      );
    }

    const mode = args[0].toLowerCase();

    // âœ… Validate argument
    if (!["public", "private"].includes(mode)) {
      return sock.sendMessage(
        from,
        {
          text: `
âš™ï¸ *Usage:*
â€¢ .mode public
â€¢ .mode private
          `.trim(),
        },
        { quoted: msg }
      );
    }

    // âœ… Save new mode to config.js
    config.mode = mode;
    fs.writeFileSync("./config.js", `export default ${JSON.stringify(config, null, 2)};\n`);

    // âœ… Confirmation message
    await sock.sendMessage(
      from,
      {
        text: `
â”â”â”ğŸ¤– *${botName.toUpperCase()} BOT* â”â”â”“
âœ… Mode changed successfully!
ğŸ”¹ New Mode: *${mode.toUpperCase()}*
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
        `.trim(),
      },
      { quoted: msg }
    );
  },
};
